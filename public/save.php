

<?php
include ('../vendor/autoload.php');
require_once ('../src/config.php');

use App\library\Database;
use App\library\QueryToDB;
use App\library\Validate;



if (isset($_POST['data'])) {

    $str = "[{\"date_publish\":\"2017-06-22\",\"id\":\"1152414528\",\"img\":\"//img5.leboncoin.fr/ad-thumb/9017c9f65432303a0bc2b5df44a6c8c10875984d.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1152414528.htm?ca=6_s\",\"price\":\"500\",\"title\":\"Opel combo\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1152414209\",\"img\":\"//img3.leboncoin.fr/ad-thumb/b830898f071f26d97f03048b068ede3d46cf96a2.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1152414209.htm?ca=6_s\",\"price\":\"12750\",\"title\":\"Land rover series 2a 1961\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1152413880\",\"img\":\"//img2.leboncoin.fr/ad-thumb/2d7a812472137b915768b420b3fb3aae9ef753e3.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1152413880.htm?ca=6_s\",\"price\":\"3490\",\"title\":\"Peugeot 206 x design\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1143102500\",\"img\":\"//img5.leboncoin.fr/ad-thumb/87f49233ecf31b6230d9dce96205f29e26c650ba.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1143102500.htm?ca=6_s\",\"price\":\"14800\",\"title\":\"Peugeot 508SW FELINE 2.0 163 BVA\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1152412359\",\"img\":\"//img3.leboncoin.fr/ad-thumb/fb38bd637cf27d4f588faaee96e8d1855196d6b7.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1152412359.htm?ca=6_s\",\"price\":\"4000\",\"title\":\"range rover classic\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1145897085\",\"img\":\"//img5.leboncoin.fr/ad-thumb/52a2ba338259af22d98cd3ea0ec840244e6c5873.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1145897085.htm?ca=6_s\",\"price\":\"17950\",\"title\":\"MINI COOPER D COUNTRYMAN 112 Ch BVM6\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1152412035\",\"img\":\"//img7.leboncoin.fr/ad-thumb/80b18cb8001a74a76eb51dfd4d35e5ae309daa68.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1152412035.htm?ca=6_s\",\"price\":\"1490\",\"title\":\"Jolie Peugeot 106 phase 2 1.0 i 50cv kid\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1152407016\",\"img\":\"//img6.leboncoin.fr/ad-thumb/ec471bd5745a5627ed89f8cfcd05fee03011482d.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1152407016.htm?ca=6_s\",\"price\":\"2000\",\"title\":\"Opel signum (ventra) 2.2 dti\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1152405928\",\"img\":\"//img1.leboncoin.fr/ad-thumb/2aff615d9be9dfb931e8085a6dc7b1a7876cbda4.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1152405928.htm?ca=6_s\",\"price\":\"14500\",\"title\":\"Mercedes Classe C230\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1152405205\",\"img\":\"\",\"link\":\"//www.leboncoin.fr/voitures/1152405205.htm?ca=6_s\",\"price\":\"3100\",\"title\":\"Toyota verso\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1152404262\",\"img\":\"//img2.leboncoin.fr/ad-thumb/83ac94eeec59c8b6350c17b696710156c0cfe51b.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1152404262.htm?ca=6_s\",\"price\":\"21500\",\"title\":\"mini cooper s 192 cv\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1152402039\",\"img\":\"//img5.leboncoin.fr/ad-thumb/95f1b89cfbebdbdecad815d5b596ef1117394e7a.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1152402039.htm?ca=6_s\",\"price\":\"8100\",\"title\":\"Clio IV eco2 2013\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1152401934\",\"img\":\"//img1.leboncoin.fr/ad-thumb/49e8358b6984edb88c058be36a8adc414bed75c8.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1152401934.htm?ca=6_s\",\"price\":\"5490\",\"title\":\"Peugeot Partner 1l4i essence (Propre)\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1133778117\",\"img\":\"//img7.leboncoin.fr/ad-thumb/889e9419ffb8ac4c88cdaf3afdb9996f778bb9a6.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1133778117.htm?ca=6_s\",\"price\":\"38000\",\"title\":\"Defender 90 sw se -4 places - etat neuf\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1147073366\",\"img\":\"//img4.leboncoin.fr/ad-thumb/87f84db98e16c9400e7e205472600ea1955ef247.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1147073366.htm?ca=6_s\",\"price\":\"4500\",\"title\":\"Hyundai I30 2l crdi 136ch révisée garantie\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1140466717\",\"img\":\"//img6.leboncoin.fr/ad-thumb/5b754f0e7a58832483d266e3a2b2bfa9e7afca48.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1140466717.htm?ca=6_s\",\"price\":\"14900\",\"title\":\"Golf 7 1.6 TDI 110 cv Confortline Bluemotion GPS\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1152399480\",\"img\":\"//img2.leboncoin.fr/ad-thumb/9c72a19a2337b6297cb5bbef22793ef74b01261b.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1152399480.htm?ca=6_s\",\"price\":\"1000\",\"title\":\"Opel ASTRA GTC 1.6\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1152399390\",\"img\":\"//img7.leboncoin.fr/ad-thumb/b58fabdee4062edd626c17df8edeb0a349d832ef.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1152399390.htm?ca=6_s\",\"price\":\"15500\",\"title\":\"X1\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1152399161\",\"img\":\"//img1.leboncoin.fr/ad-thumb/3ea2357d53c8205c977578ccee2cf8581188131f.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1152399161.htm?ca=6_s\",\"price\":\"8300\",\"title\":\"BMW 330 xd \"},{\"date_publish\":\"2017-06-22\",\"id\":\"1152399042\",\"img\":\"//img4.leboncoin.fr/ad-thumb/2011c64ef6c0209d60238aef4f7193213e533bc6.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1152399042.htm?ca=6_s\",\"price\":\"3200\",\"title\":\"GRand Scénic II 1.5 DCI 106 CV\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1152398949\",\"img\":\"//img0.leboncoin.fr/ad-thumb/acba4ebd783e0c7c1f735a6526f217afcb18cf50.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1152398949.htm?ca=6_s\",\"price\":\"1500\",\"title\":\"Opel vectra 2.0 DTI 105 cv CT OK\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1124983351\",\"img\":\"//img6.leboncoin.fr/ad-thumb/38da1ce55ea783f550160681a1b6c4f2b7c95168.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1124983351.htm?ca=6_s\",\"price\":\"2300\",\"title\":\"Opel Corsa B 1.4i 60CH Viva BVA *95350 Kms 3P\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1124974802\",\"img\":\"//img5.leboncoin.fr/ad-thumb/b991e6febc1de19e1bd489e1cd7b8d372bb176ce.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1124974802.htm?ca=6_s\",\"price\":\"700\",\"title\":\"Saab 9.5 2.0 T 150CH SE *MOTEUR HS* PRO OU EXPORT\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1152398079\",\"img\":\"\",\"link\":\"//www.leboncoin.fr/voitures/1152398079.htm?ca=6_s\",\"price\":\"300\",\"title\":\"Opel corsa city\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1143087368\",\"img\":\"//img3.leboncoin.fr/ad-thumb/54573cc6594d35d09feac350dcd5054ee0398505.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1143087368.htm?ca=6_s\",\"price\":\"7500\",\"title\":\"Renault Scénic III 1.9 DCI130 FAP EXCEPTON-5pls\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1152396617\",\"img\":\"//img7.leboncoin.fr/ad-thumb/84c6e28a54a7ff8f82c78bedb1f6d8b5f8d2781e.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1152396617.htm?ca=6_s\",\"price\":\"1900\",\"title\":\"Vw golf iv\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1152396115\",\"img\":\"//img3.leboncoin.fr/ad-thumb/069ab16e1f840b60fd89a6464f418f4e6b8b99ce.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1152396115.htm?ca=6_s\",\"price\":\"7350\",\"title\":\"Citroen C5 2.0 140 C.V Millennium \"},{\"date_publish\":\"2017-06-22\",\"id\":\"1152393864\",\"img\":\"//img3.leboncoin.fr/ad-thumb/d8adf888399d439cc5e8c74270ffadead82b84e0.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1152393864.htm?ca=6_s\",\"price\":\"5000\",\"title\":\"Kia cee'd SW 1,6 CRDI 90\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1152393331\",\"img\":\"//img3.leboncoin.fr/ad-thumb/fe0c5d830c801fdcaabdf857c13bae0ead2f7d90.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1152393331.htm?ca=6_s\",\"price\":\"19000\",\"title\":\"308 SW 1.6HDI 120cv Stop&Start\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1152392261\",\"img\":\"//img0.leboncoin.fr/ad-thumb/d14687e9df7ba206b122aef7947b30411991fdf0.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1152392261.htm?ca=6_s\",\"price\":\"600\",\"title\":\"Mégane Renault\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1152390755\",\"img\":\"//img5.leboncoin.fr/ad-thumb/a5b2cead674f03ad4c5fb793835dd5116025713c.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1152390755.htm?ca=6_s\",\"price\":\"700\",\"title\":\"Ford focus '99\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1130668490\",\"img\":\"//img7.leboncoin.fr/ad-thumb/bc80e4b46261e40d12b4df72079a511ddaf01a2b.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1130668490.htm?ca=6_s\",\"price\":\"4990\",\"title\":\"207 hdi 90cv premium\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1146454723\",\"img\":\"//img3.leboncoin.fr/ad-thumb/8435eceffff692013d88f0b2720ee9ebadb1c03b.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1146454723.htm?ca=6_s\",\"price\":\"2990\",\"title\":\"fiat punto 1.2 60 cv 1 ère main\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1138109437\",\"img\":\"//img2.leboncoin.fr/ad-thumb/df2e06ffe04a17a12b3f15fcbef6a167bc5db80c.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1138109437.htm?ca=6_s\",\"price\":\"3500\",\"title\":\"Grand Renault Scenic 7 places 1.6i privilege\"},{\"date_publish\":\"2017-06-22\",\"id\":\"1137903154\",\"img\":\"//img6.leboncoin.fr/ad-thumb/bf6a03757535ceea2e016d86b89a569a91f44f26.jpg\",\"link\":\"//www.leboncoin.fr/voitures/1137903154.htm?ca=6_s\",\"price\":\"3850\",\"title\":\"Ford Fusion 1.4i 80cv entièrement révisé\"}]";
    $query = new QueryToDB();
    $validation = new Validate;

    foreach (json_decode($_POST['data']) as $key) {

       // if (property_exists("key", "id")){

            $title = $validation->validation('text', $key->title, null, null);

            $price = $validation->validation('price', $key->price, null, null);
            $date = $validation->validation('date', $key->date_publish, null, null);


            $sql = "INSERT IGNORE INTO leboncoin_voitures (product_id, title, price, image, massage, date_publish, link) VALUES ('" . $key->id . "', '" . $title . "', '" . $price . "', '" . $key->img . "', 0, '" . $date . "', '" . $key->link . "')";
            $result = $query->queryToDB($sql);
    //    }
    }
}